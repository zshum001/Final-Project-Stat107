---
title: "Stat107 Final Project"
subtitle: "How do harmful air pollutant concentrations vary across different months within a year?"
author: "Crystal Kuong, Gracelynne Mohad, Sumeet Sammi, Zoe Shum"
date: "2024-12-13"
format:
  html:
    toc: true
    toc-location: left
    embed-resources: true
    code-line-numbers: true
    page-layout: full
  pdf:
    fontsize: 10pt
    code-line-numbers: true
---

# Introduction

Air quality is a critical component in environmental health, directly influencing both the ecosystem and human well-being. It is determined by the presence of various pollutants including, but not limited to nitrogen dioxide and carbon monoxide. Poor air quality is linked to serious health issues, including respiratory diseases, cardiovascular problems, and reduced life expectancy. Moreover, air pollution contributes to climate change and harming wildlife. Monitoring and understanding air quality prompts initiatives centered on reducing the concentration of air pollutants, thereby, creating a cleaner environment.

## The Question

This study investigates: How do harmful air pollutant concentrations vary across different months of the year? By examining seasonal trends and monthly variations in pollutants, we aim to identify patterns that may arise due to seasonal changes, human activities, or environmental factors.

The specific pollutants we will explore in this study include:

1.  **Carbon Monoxide** ($CO$):

2.  **Non-Methane Hydrocarbon** ($NMHC$):

3.  **Nitrogen Dioxide** ($NO_2$):

4.  **Nitrogen Oxide** ($NOx$):

5.  **Ozone** ($O_3$):

# The Dataset

The **UCI Air Quality Dataset**, sourced from the University of California, Irvine via Kaggle, tracks the concentration of five key air pollutants, including carbon monoxide, benzene, and nitrogen dioxide. The data spans from March 2004 to April 2005, recording hourly pollutant levels for a specific area.

### Packages

```{r}
library(readxl)
library(ggplot2)
library(lubridate)
library(tidyverse)
```

## Reading Dataset

```{r}
#| code-fold: true
air <- read_excel("AirQualityUCI.xls")
head(air)
```

The original dataset includes **9,357 observations** and **15 variables**, which are summarized below:

1.  `Date`: Date of measurement.

2.  `Time`: Time of measurement.

3.  `CO(GT)`: Carbon monoxide (CO) concentration (µg/m³).

4.  `PT0.S1(CO)`: Sensor measurement for CO.

5.  `NMHC(GT)`: Non-methane hydrocarbons (NMHC) concentration (µg/m³).

6.  `C6H6(GT)`: Benzene (C6H6) concentration (µg/m³).

7.  `PT08.S2(NMHC)`: Sensor measurement for NMHC.

8.  `NOx(GT)`: Nitrogen oxide (NOx) concentration (µg/m³).

9.  `PT08.S3(NOx)`: Sensor measurement for NOx.

10. `NO2(GT)`: Concentration of nitrogen dioxide (NO2) in the air (µg/m³).

11. `PT08.S4(NO2)`: Sensor measurement for NO2.

12. `PT08.S5(O3)`: Sensor measurement for ozone (O3).

13. `T`: Temperature (Celsius).

14. `RH`: Relative humidity (g/m³).

15. `AH`: Absolute humidity (g/m³).

### Renaming Columns

To improve clarity, variables were renamed as follows:

```{r}
#| code-fold: true
air <- air %>% 
  rename(
    CO = `CO(GT)`,
    S_CO = `PT08.S1(CO)`,
    NMHC = `NMHC(GT)`,
    S_NMHC = `PT08.S2(NMHC)`,
    C6H6 = `C6H6(GT)`,
    NOx = `NOx(GT)`,
    S_NOx = `PT08.S3(NOx)`,
    NO2 = `NO2(GT)`,
    S_NO2 = `PT08.S4(NO2)`,
    S_O3 = `PT08.S5(O3)`
  )
```

| Old Name        | New Name |
|-----------------|----------|
| `CO(GT)`        | `CO`     |
| `PT0.S1(CO)`    | `S_CO`   |
| `NMHC(GT)`      | `NMHC`   |
| `PT08.S2(NMHC)` | `S_NMHC` |
| `C6H6(GT)`      | `C6H6`   |
| `NOx(GT)`       | `NOx`    |
| `PT08.S3(NOx)`  | `S_NOx`  |
| `NO2(GT)`       | `NO2`    |
| `PT08.S4(NO2)`  | `S_NO2`  |
| `PT08.S5(O3)`   | `S_O3`   |

## Detecting and Removing Outliers

```{r}
#| code-fold: true
# Histogram for S_CO 
hist(air$S_CO,
     main = "Histogram of CO concentrations",
     xlab = "CO concentrations")
```

Using the variable **S_CO** as a test case, a histogram revealed the presence of noticeable outliers. These outliers were identified and removed using the **Interquartile Range (IQR) method** to improve data quality.

The outcome:

-   484 observations were removed.

-   The distribution of **S_CO** shifted closer to normality, although still retaining a slight positive skew.

```{r}
#| code-fold: true
# Calculate IQR
Q1 <- quantile(air$S_CO, 0.25, na.rm = TRUE)
Q3 <- quantile(air$S_CO, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1

# Define outlier bounds
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR

# Filter rows to remove outliers
air_filtered <- air[air$S_CO >= lower_bound & air$S_CO <= upper_bound, ]
# Reassign original dataset with filtered dataset
air <- air_filtered

hist(air_filtered$S_CO,
     main = "Histogram of CO concentrations (after filtering)",
     xlab = "CO concentrations")
```

## Reformatting

To effectively analyze monthly variations in pollutant concentrations, the dataset will be reorganized by grouping the data by month and year, calculating the average values for each variable within these groups. This restructuring will provide a clearer understanding of seasonal trends and fluctuations.

```{r}
#| code-fold: true
# Convert 'Date' column to y-m-d format
air$Date <- ymd(air$Date)

# Create numerical Month and Year columns
air <- air %>%
  mutate(
    Month = month(Date, label = TRUE), # Extracts month as a numeric value (1-12)
    Year = year(Date)    # Extracts year
  )

# Group by Year and Month for summarization
airM <- air %>%
  group_by(Year, Month) %>%
  summarize(across(where(is.numeric), ~mean(., na.rm = TRUE)))

head(airM, 5)
```

```{r}
#| code-fold: true
#Summarize data (excluding Year and Month columns )
summary(airM[, -c(1, 2)])
```

Upon inspecting the dataset, some non-sensor measurements (e.g., CO, NMHC) revealed unusual negative means, suggesting potential inaccuracies. For this reason, the analysis will prioritize **sensor-based variables**.

# Analysis

## Graphs

```{r fig.width=10, fig.height=6}
#| code-fold: true
# Plot monthly Concentrations
airM %>%
  # Use interaction to combine Month and Year
  ggplot(aes(x = interaction(Month, Year, sep = "-"))) +
  # Add points and lines for different pollutants
  geom_point(aes(y = S_CO, color = "Carbon Monoxide")) + 
  geom_line(aes(y = S_CO, color = "Carbon Monoxide", group = 1)) +
  geom_point(aes(y = S_NMHC, color = "Non-Methane Hydrocarbon")) +
  geom_line(aes(y = S_NMHC, color = "Non-Methane Hydrocarbon", group = 2)) +
  geom_point(aes(y = S_NOx, color = "Nitrogen Oxide")) + 
  geom_line(aes(y = S_NOx, color = "Nitrogen Oxide", group = 3)) +
  geom_point(aes(y = S_NO2, color = "Nitrogen Dioxide")) + 
  geom_line(aes(y = S_NO2, color = "Nitrogen Dioxide", group = 3)) +
  geom_point(aes(y = S_O3, color = "Ozone")) + 
  geom_line(aes(y = S_O3, color = "Ozone", group = 3)) +
  labs(
    title = "Total Movies vs. War Movies",
    x = "Month-Year",
    y = "Concentrations in µg/m³"
  ) +
  scale_color_manual(
    values = c("Carbon Monoxide" = "blue", 
               "Non-Methane Hydrocarbon" = "red", 
               "Nitrogen Oxide" = "chartreuse3",
               "Nitrogen Dioxide" = "purple",
               "Ozone" = "magenta"),
    name = "Pollutants"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels
```

```{r fig.width=10, fig.height=6}
#| code-fold: true
# Plot monthly Temperatures and Relative Humidity
airM %>%
  pivot_longer(
    cols = c(RH, T), 
    names_to = "Variable", 
    values_to = "Value"
  ) %>%
  ggplot(aes(x = interaction(Month, Year, sep = "-"), y = Value, fill = Variable)) +
  geom_col(position = "dodge") +
  labs(
    title = "Temperature and Relative Humidity by Month",
    x = "Month-Year",
    y = "Values",
    fill = "Variable"
  ) +
  scale_fill_manual(
    values = c("T" = "coral", "RH" = "darkgoldenrod1"),
    labels = c("T" = "Temperature (°C)", "RH" = "Relative Humidity (g/m³)")
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Tests

```{r}
```

# Conclusion

## Addressing Potential Errors 
