---
title: "Stat107 Final Project"
subtitle: "How do harmful air pollutant concentrations vary across different months within a year?"
author: "Crystal Kuong, Gracelynne Mohad, Sumeet Sammi, Zoe Shum"
date: "2024-12-13"
format:
  html:
    toc: true
    toc-location: left
    embed-resources: true
    code-line-numbers: true
    page-layout: full
  pdf:
    fontsize: 10pt
    code-line-numbers: true
---

# Introduction

Air quality is a critical component in environmental health, directly influencing both the ecosystem and human well-being. It is determined by the presence of various pollutants including, but not limited to nitrogen dioxide and carbon monoxide. Poor air quality is linked to serious health issues, including respiratory diseases, cardiovascular problems, and reduced life expectancy. Moreover, air pollution contributes to climate change and harming wildlife. Monitoring and understanding air quality prompts initiatives centered on reducing the concentration of air pollutants, thereby, creating a cleaner environment.

## The Dataset

The UCI Air Quality Dataset was collected by the University of California, Irvine and acquired from Kaggle. It measures the concentration of about 5 different pollutants in the air in a given area. Some pollutants that are measured include carbon monoxide, benzene, and nitrogen dioxide. It measures pollutant concentrations every hour from March 2004 to April 2005.

## Plan for Analysis

```{r}
#1: options(width = 50)

# Load libraries
library(readxl)
library(dplyr)
library(lubridate)
library(ggplot2)

#Read dataset
air <- read.csv("AirQualityUCI.csv")
head(air)

#Number of rows and columns
dim(air)

#Column names
colnames(air)

# Number of rows and columns
dim(air)

# Column names
colnames(air)


#Convert 'Date' column to date format
air$Date <- mdy(air$Date)
# air$Date <- as.Date(air$Date)
air$Date <- format(air$Date, "%Y-%m")

# Group by month, calculate average for each numeric column across all month groups, while removing NA values
airM <- air %>% 
  group_by(Date) %>% 
  summarise(across(where(is.numeric), ~mean(., na.rm = TRUE)))

# List of pollutants
pollutants <- c('CO.GT.', 'PT08.S1.CO.', 'NMHC.GT.', 'C6H6.GT.', 
                'PT08.S2.NMHC.', 'NOx.GT.', 'PT08.S3.NOx.', 
                'NO2.GT.', 'PT08.S4.NO2.', 'PT08.S5.O3.')

# Gather data into long format for easier faceting. Clean data by removing NA and negative values
airM_long <- airM %>%
  pivot_longer(cols = pollutants, names_to = "pollutant", values_to = "avg_pollutant") %>%
  filter(!is.na(avg_pollutant) & avg_pollutant >= 0)

# Count how many observations are left after filtering
remaining_obs <- nrow(airM_long)

# Print the number of remaining observations
cat(paste(remaining_obs, "observations remain after cleaning.\n"))

# Create the plot with facet_grid()
plot <- ggplot(airM_long, aes(x = Date, y = avg_pollutant)) +
  geom_bar(stat = 'identity', position = 'dodge') +
  labs(title = "Average Concentration of Pollutants by Month", 
       x = "Date", 
       y = "Average Concentration") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(pollutant ~ ., scales = "free_y") +  # Facet by pollutant
  theme(strip.text.y = element_text(angle = 0), 
        axis.text.y = element_text(size = 7),
        plot.margin = margin(10, 10, 10, 10)
        )

print(plot)
```
